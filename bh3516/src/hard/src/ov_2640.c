//标准头文件包含区域
#include <stdlib.h>
#include <unistd.h>

//自定义头文件包含区域
#include "i2c_ctl.h"
#include "ov_2640.h"
#include "printf_func.h"

//常量定义区

//文件内部使用的宏

//文件内部使用的数据类型

//全局变量

const unsigned char ov2640_yuv_init[][2]=
{
	{0xFF,0X00},//设置选择dsp
	{0xFF,0X00},
	{0x2C,0XFF},
	{0x2E,0XDF},
	{0xFF,0X01},
	{0x3C,0X32},
	{0x11,0X00},
	{0x09,0X02},
	{0x03,0XCA},
	{0x04,0X08},
	{0x13,0XE5},
	{0x14,0X48},
	{0x2C,0X0C},
	{0x33,0X78},
	{0x3A,0X33},
	{0x3B,0XFB},
	{0x3E,0X00},
	{0x43,0X11},
	{0x16,0X10},
	{0x39,0X02},
	{0x35,0X88},
	{0x22,0X0A},
	{0x37,0X40},
	{0x23,0X00},
	{0x34,0XA0},
	{0x36,0X1A},
	{0x06,0X02},
	{0x07,0XC0},
	{0x0D,0XB7},
	{0x0E,0X01},
	{0x4C,0X00},
	{0x4A,0X81},
	{0x21,0X99},
	{0x24,0X3A},
	{0x25,0X32},
	{0x26,0X82},
	{0x5C,0X00},
	{0x63,0X00},
	{0x5D,0X55},
	{0x5E,0X7D},
	{0x5F,0X7D},
	{0x60,0X55},
	{0x61,0X70},
	{0x62,0X80},
	{0x7C,0X05},
	{0x20,0X80},
	{0x28,0X30},
	{0x6C,0X00},
	{0x6D,0X80},
	{0x6E,0X00},
	{0x70,0X02},
	{0x71,0X96},
	{0x73,0XE1},
	{0x3D,0X34},
	{0x5A,0X57},
	{0x4F,0XBB},
	{0x50,0X9C},
	{0x0F,0X43},
	{0xFF,0X00},
	{0xE5,0X7F},
	{0xF9,0XC0},
	{0x41,0X24},
	{0xE0,0X14},
	{0x76,0XFF},
	{0x33,0XA0},
	{0x42,0X20},
	{0x43,0X18},
	{0x4C,0X00},
	{0x87,0XD0},
	{0x88,0X3F},
	{0xD7,0X03},
	{0xD9,0X10},
	{0xD3,0X82},
	{0xC8,0X08},
	{0xC9,0X80},
	{0x7C,0X00},
	{0x7D,0X02},
	{0x7C,0X03},
	{0x7D,0X48},
	{0x7D,0X48},
	{0x7C,0X08},
	{0x7D,0X20},
	{0x7D,0X10},
	{0x7D,0X0E},
	{0x90,0X00},
	{0x91,0X0E},
	{0x91,0X1A},
	{0x91,0X31},
	{0x91,0X5A},
	{0x91,0X69},
	{0x91,0X75},
	{0x91,0X7E},
	{0x91,0X88},
	{0x91,0X8F},
	{0x91,0X96},
	{0x91,0XA3},
	{0x91,0XAF},
	{0x91,0XC4},
	{0x91,0XD7},
	{0x91,0XE8},
	{0x91,0X20},
	{0x92,0X00},
	{0x93,0X06},
	{0x93,0XE3},
	{0x93,0X05},
	{0x93,0X05},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x96,0X00},
	{0x97,0X08},
	{0x97,0X19},
	{0x97,0X02},
	{0x97,0X0C},
	{0x97,0X24},
	{0x97,0X30},
	{0x97,0X28},
	{0x97,0X26},
	{0x97,0X02},
	{0x97,0X98},
	{0x97,0X80},
	{0x97,0X00},
	{0x97,0X00},
	{0xC3,0XED},
	{0xA4,0X00},
	{0xA8,0X00},
	{0xBF,0X00},
	{0xBA,0XF0},
	{0xBC,0X64},
	{0xBB,0X02},
	{0xB6,0X3D},
	{0xB8,0X57},
	{0xB7,0X38},
	{0xB9,0X4E},
	{0xB3,0XE8},
	{0xB4,0XE1},
	{0xB5,0X66},
	{0xB0,0X67},
	{0xB1,0X5E},
	{0xB2,0X04},
	{0xC7,0X00},
	{0xC6,0X51},
	{0xC5,0X11},
	{0xC4,0X9C},
	{0xCF,0X02},
	{0xA6,0X00},
	{0xA7,0XE0},
	{0xA7,0X10},
	{0xA7,0X1E},
	{0xA7,0X21},
	{0xA7,0X00},
	{0xA7,0X28},
	{0xA7,0XD0},
	{0xA7,0X10},
	{0xA7,0X16},
	{0xA7,0X21},
	{0xA7,0X00},
	{0xA7,0X28},
	{0xA7,0XD0},
	{0xA7,0X10},
	{0xA7,0X17},
	{0xA7,0X21},
	{0xA7,0X00},
	{0xA7,0X28},
	{0xC0,0X64},//100
	{0xC1,0X4b},//75
	{0x86,0X1D},
	{0x50,0X00},
	{0x51,0XC8},//200
	{0x52,0X96},//150
	{0x53,0X00},
	{0x54,0X00},
	{0x55,0X00},//00
	{0x57,0X00},
	{0x5A,0XC8},//200
	{0x5B,0X96},//150
	{0x5C,0X00},//00
	{0xC3,0XEF},
	{0x7F,0X00},
	{0xDA,0X00},
	{0xE5,0X1F},
	{0xE1,0X67},
	{0xE0,0X00},
	{0xDD,0XFF},
	{0x05,0X00},
	{0xFF,0X01},
	{0xFF,0X01},
	{0x12,0X40},
	{0x17,0X11},
	{0x18,0X43},
	{0x19,0X00},
	{0x1A,0X97},
	{0x32,0X09},
	{0x4F,0XBB},
	{0x50,0X9C},
	{0x5A,0X57},
	{0x6D,0X80},
	{0x39,0X02},
	{0x35,0X88},
	{0x22,0X0A},
	{0x37,0X40},
	{0x23,0X00},
	{0x34,0XA0},
	{0x36,0X1A},
	{0x06,0X02},
	{0x07,0XC0},
	{0x0D,0XB7},
	{0x0E,0X01},
	{0x4C,0X00},
	{0xFF,0X00},
	{0xE0,0X04},
	{0xC0,0X64},//100
	{0xC1,0X4b},//50
	{0x86,0X1D},
	{0x50,0X00},
	{0x51,0XC8},//200
	{0x52,0X96},//150
	{0x53,0X00},
	{0x54,0X00},
	{0x55,0X00},//00
	{0x57,0X00},
	{0x5A,0XC8},//200
	{0x5B,0X96},//150
	{0x5C,0X00},//00
	{0xE0,0X00},
	{0xFF,0X01},
	{0x11,0X01},
	{0x3D,0X34},
	{0x50,0X80},
	{0xFF,0X00},
	{0xD3,0X82},
	{0xFF,0X01}
};

/*const unsigned char ov2640_yuv_init[][2]={
	{0xFF,0X00},
	{0xFF,0X00},
	{0x2C,0XFF},
	{0x2E,0XDF},
	{0xFF,0X01},
	{0x3C,0X32},
	{0x11,0X00},
	{0x09,0X02},
	{0x03,0XCF},
	{0x04,0X08},
	{0x13,0XE5},
	{0x14,0X48},
	{0x2C,0X0C},
	{0x33,0X78},
	{0x3A,0X33},
	{0x3B,0XFB},
	{0x3E,0X00},
	{0x43,0X11},
	{0x16,0X10},
	{0x39,0X02},
	{0x35,0X88},
	{0x22,0X0A},
	{0x37,0X40},
	{0x23,0X00},
	{0x34,0XA0},
	{0x36,0X1A},
	{0x06,0X02},
	{0x07,0XC0},
	{0x0D,0XB7},
	{0x0E,0X01},
	{0x4C,0X00},
	{0x4A,0X81},
	{0x21,0X99},
	{0x24,0X3A},
	{0x25,0X32},
	{0x26,0X82},
	{0x5C,0X00},
	{0x63,0X00},
	{0x5D,0X55},
	{0x5E,0X7D},
	{0x5F,0X7D},
	{0x60,0X55},
	{0x61,0X70},
	{0x62,0X80},
	{0x7C,0X05},
	{0x20,0X80},
	{0x28,0X30},
	{0x6C,0X00},
	{0x6D,0X80},
	{0x6E,0X00},
	{0x70,0X02},
	{0x71,0X96},
	{0x73,0XE1},
	{0x3D,0X34},
	{0x5A,0X57},
	{0x4F,0XBB},
	{0x50,0X9C},
	{0x0F,0X43},
	{0xFF,0X00},
	{0xE5,0X7F},
	{0xF9,0XC0},
	{0x41,0X24},
	{0xE0,0X14},
	{0x76,0XFF},
	{0x33,0XA0},
	{0x42,0X20},
	{0x43,0X18},
	{0x4C,0X00},
	{0x87,0XD0},
	{0x88,0X3F},
	{0xD7,0X03},
	{0xD9,0X10},
	{0xD3,0X82},
	{0xC8,0X08},
	{0xC9,0X80},
	{0x7C,0X00},
	{0x7D,0X02},
	{0x7C,0X03},
	{0x7D,0X48},
	{0x7D,0X48},
	{0x7C,0X08},
	{0x7D,0X20},
	{0x7D,0X10},
	{0x7D,0X0E},
	{0x90,0X00},
	{0x91,0X0E},
	{0x91,0X1A},
	{0x91,0X31},
	{0x91,0X5A},
	{0x91,0X69},
	{0x91,0X75},
	{0x91,0X7E},
	{0x91,0X88},
	{0x91,0X8F},
	{0x91,0X96},
	{0x91,0XA3},
	{0x91,0XAF},
	{0x91,0XC4},
	{0x91,0XD7},
	{0x91,0XE8},
	{0x91,0X20},
	{0x92,0X00},
	{0x93,0X06},
	{0x93,0XE3},
	{0x93,0X05},
	{0x93,0X05},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x93,0X00},
	{0x96,0X00},
	{0x97,0X08},
	{0x97,0X19},
	{0x97,0X02},
	{0x97,0X0C},
	{0x97,0X24},
	{0x97,0X30},
	{0x97,0X28},
	{0x97,0X26},
	{0x97,0X02},
	{0x97,0X98},
	{0x97,0X80},
	{0x97,0X00},
	{0x97,0X00},
	{0xC3,0XED},
	{0xA4,0X00},
	{0xA8,0X00},
	{0xBF,0X00},
	{0xBA,0XF0},
	{0xBC,0X64},
	{0xBB,0X02},
	{0xB6,0X3D},
	{0xB8,0X57},
	{0xB7,0X38},
	{0xB9,0X4E},
	{0xB3,0XE8},
	{0xB4,0XE1},
	{0xB5,0X66},
	{0xB0,0X67},
	{0xB1,0X5E},
	{0xB2,0X04},
	{0xC7,0X00},
	{0xC6,0X51},
	{0xC5,0X11},
	{0xC4,0X9C},
	{0xCF,0X02},
	{0xA6,0X00},
	{0xA7,0XE0},
	{0xA7,0X10},
	{0xA7,0X1E},
	{0xA7,0X21},
	{0xA7,0X00},
	{0xA7,0X28},
	{0xA7,0XD0},
	{0xA7,0X10},
	{0xA7,0X16},
	{0xA7,0X21},
	{0xA7,0X00},
	{0xA7,0X28},
	{0xA7,0XD0},
	{0xA7,0X10},
	{0xA7,0X17},
	{0xA7,0X21},
	{0xA7,0X00},
	{0xA7,0X28},
	{0xC0,0XC8},
	{0xC1,0X96},
	{0x86,0X1D},
	{0x50,0X00},
	{0x51,0X90},
	{0x52,0X18},
	{0x53,0X00},
	{0x54,0X00},
	{0x55,0X88},
	{0x57,0X00},
	{0x5A,0X90},
	{0x5B,0X18},
	{0x5C,0X05},
	{0xC3,0XEF},
	{0x7F,0X00},
	{0xDA,0X00},
	{0xE5,0X1F},
	{0xE1,0X67},
	{0xE0,0X00},
	{0xDD,0XFF},
	{0x05,0X00},
	{0xFF,0X01},
	{0xFF,0X01},
	{0x12,0X00},
	{0x17,0X11},
	{0x18,0X75},
	{0x19,0X01},
	{0x1A,0X97},
	{0x32,0X36},
	{0x4F,0XBB},
	{0x50,0X9C},
	{0x5A,0X57},
	{0x6D,0X80},
	{0x39,0X02},
	{0x35,0X88},
	{0x22,0X0A},
	{0x37,0X40},
	{0x23,0X00},
	{0x34,0XA0},
	{0x36,0X1A},
	{0x06,0X02},
	{0x07,0XC0},
	{0x0D,0XB7},
	{0x0E,0X01},
	{0x4C,0X00},
	{0xFF,0X00},
	{0xE0,0X04},
	{0xC0,0XC8},
	{0xC1,0X96},
	{0x86,0X1D},
	{0x50,0X00},
	{0x51,0X90},
	{0x52,0X2C},
	{0x53,0X00},
	{0x54,0X00},
	{0x55,0X88},
	{0x57,0X00},
	{0x5A,0X90},
	{0x5B,0X2C},
	{0x5C,0X05},
	{0xE0,0X00},
	{0xFF,0X01},
	{0x11,0X01},
	{0x3D,0X34},
	{0x50,0X80},
	{0xFF,0X00},
	{0xD3,0X82},
	{0xFF,0X01}
};*/

//静态局部变量
static const unsigned char 	ov2640_i2c_addr		= 0x60;
static const unsigned int  	ov2640_addr_byte		= 1;
static const unsigned int  	ov2640_data_byte		= 1;	

//内部函数

/*
* 功能描述	：	读2640寄存器
* 成员更新	:		无
* 输入参数	：	无
* 输出参数	：	无
* 返 回 值	：		寄存器数据内容
* 其它说明	：	无
* 修改日期	:		2015.08.09
* -----------------------------------------------
* 2015/08/09 V1.0		XXXX		  XXXX
*/
int ov2640_read_register(int addr)
{
	return i2c_read_data(ov2640_i2c_addr, addr, ov2640_addr_byte, ov2640_data_byte);
}

/*
* 功能描述	：	写2640寄存器
* 成员更新	:		无
* 输入参数	：	无
* 输出参数	：	无
* 返 回 值	：		0		成功
										-1	失败
* 其它说明	：	无
* 修改日期	:		2015.08.09
* -----------------------------------------------
* 2015/08/09 V1.0		XXXX		  XXXX
*/
int ov2640_write_register(int addr, int data)
{
 	return i2c_write_data(ov2640_i2c_addr ,addr, data, ov2640_addr_byte, ov2640_data_byte);
}

/*
* 功能描述	：	配置800 * 600 yuv
* 成员更新	:		无
* 输入参数	：	无
* 输出参数	：	无
* 返 回 值	：		无
* 其它说明	：	无
* 修改日期	:		2015.08.09
* -----------------------------------------------
* 2015/08/09 V1.0		XXXX		  XXXX
*/

void ov2640_yuv_800_config(void)
{
	unsigned int i;
	ov2640_write_register(0xFF, 0x01);
	ov2640_write_register(0x12, 0x80);//reset
	usleep(2000);  
	/* Initialize OV2640 to output yuvdata*/
	for(i=0; i<(sizeof(ov2640_yuv_init)/2); i++)
	{
		ov2640_write_register(ov2640_yuv_init[i][0], ov2640_yuv_init[i][1]);
	}
}


//外部函数


/*
* 功能描述	：	模块初始化
* 成员更新	:		无
* 输入参数	：	无
* 输出参数	：	无
* 返 回 值	：		无
* 其它说明	：	无
* 修改日期	:		2015.08.08
* -----------------------------------------------
* 2015/08/08 V1.0		XXXX		  XXXX
*/

void ov_2640_init(void)
{
	//读取sensor id
	int id1,id2,id3,id4;
	ov2640_write_register(0xFF, 0x01);
	id1 = ov2640_read_register(0x1C);
	id2 = ov2640_read_register(0x1D);
	id3 = ov2640_read_register(0x0A);
	id4 = ov2640_read_register(0x0B);
	ptf_dbg("2640 id: %x %x %x %x\r\n",id1,id2,id3,id4);
	ov2640_yuv_800_config();
	return ;
}




